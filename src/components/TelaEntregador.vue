<template>
  <div id="cima">
    <div>
      <h1>Bem Vindo a Tela de Entregador</h1>
      <select v-model="nomeEntregador" @change="SelecionarPedido(nomeEntregador)" class="cbx">
        <option value="0" selected disabled>Entregador</option>
        <option v-for="user in listarEntregador" :key="user.id">{{user.nome}}</option>
      </select>
    </div>
    <table border="5" style="cursor:pointer" class="tabela-st">
      <thead>
        <tr>
          <th>ID Entregador</th>
          <th>Pedidos</th>
          <th>Processamento</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="(ped, index) in pedidosEntregador" :key="index">
          <td>{{entregadorSelecionado.nome}}</td>
          <td>{{ped.processamento}}</td>
          <td>
            <input type="checkbox" @click="pedidoFinalizado(ped.id)" id="cbx" />
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</template>

<script>
const axios = require("axios");

export default {
  data: function() {
    return {
      usuarios: [],
      usuariosEntregador: [],
      pedidos: [],
      pedidosEntregador: [],
      nomeEntregador: 0,
      entregadorSelecionado: [],
      entregaCliente: 0
    };
  },
  methods: {
    SelecionarPedido: function(nome) {
      this.pedidosEntregador.splice(0, this.pedidosEntregador.length);

      this.usuariosEntregador.filter(u => {
        if (u.nome == nome) {
          this.entregadorSelecionado = u;
        }
      });
      this.pedidos.filter(p => {
        if (
          p.id_entregador == this.entregadorSelecionado.id &&
          p.processamento == false
        ) {
          this.pedidosEntregador.push(p);
        }
      });
      
      if(this.pedidosEntregador == 0){
        alert("Esse entregador nÃ£o possui pedidos!")
      }
    },

    pedidoFinalizado: function(id) {
      this.pedidos.filter(n => {
        if (id == n.id) {
          this.entregaCliente = n.id_cliente;
        }
      });
      console.log(this.entregaCliente);
      axios
        .put("http://localhost:55537/api/Pedidos/" + id, {
          id_cliente: this.entregaCliente,
          id_entregador: this.entregadorSelecionado.id,
          processamento: true
        })
        .then(resp => console.log(resp.data));
        this.pedidosEntregador.splice(this.pedidosEntregador.indexOf(id), 1);
    }, 
    
    IrParaTelaMenuAdmin:function(){
        this.$router.push("/")
    }, 
},
mounted(){
    axios.get("http://localhost:55537/api/Usuario").then(usuario => this.usuarios = usuario.data)
    axios.get("http://localhost:55537/api/Pedidos").then(pedido => this.pedidos = pedido.data)
    }, 
    computed:{
  listarEntregador(){
      this.usuarios.filter(u => {
        if (u.tipo_usuario == 3) {
          this.usuariosEntregador.push(u);
        }
      });
      return this.usuariosEntregador;
    }
  }
};
</script>

<style>
#cima{
  width: 100%;
  height: 100%;
  background-color: rgba(133, 131, 131, 0.76);
  display:flex;
}
</style> 